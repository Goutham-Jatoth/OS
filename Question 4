4. Write a C program to implement the Producer ‚Äì Consumer problem using semaphores
using UNIX/LINUX system calls


üîÅ Producer‚ÄìConsumer using Semaphores (System Calls)
üìå Concept Used

Semaphores: empty, full, mutex

Shared Memory for buffer

Producer produces items

Consumer consumes items

‚úÖ C Program
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/sem.h>
#include <sys/shm.h>

#define SIZE 5

// Semaphore operations
void wait(int semid, int semnum) {
    struct sembuf sb = {semnum, -1, 0};
    semop(semid, &sb, 1);
}

void signal(int semid, int semnum) {
    struct sembuf sb = {semnum, 1, 0};
    semop(semid, &sb, 1);
}

int main() {
    int semid, shmid;
    int *buffer;
    int in = 0, out = 0;
    int i;

    // Create shared memory
    shmid = shmget(IPC_PRIVATE, SIZE * sizeof(int), 0666 | IPC_CREAT);
    buffer = (int *)shmat(shmid, NULL, 0);

    // Create semaphore set (3 semaphores)
    semid = semget(IPC_PRIVATE, 3, 0666 | IPC_CREAT);

    // Initialize semaphores
    semctl(semid, 0, SETVAL, SIZE); // empty
    semctl(semid, 1, SETVAL, 0);    // full
    semctl(semid, 2, SETVAL, 1);    // mutex

    if (fork() == 0) {
        // Producer
        for (i = 1; i <= 5; i++) {
            wait(semid, 0);   // empty
            wait(semid, 2);   // mutex

            buffer[in] = i;
            printf("Producer produced: %d\n", i);
            in = (in + 1) % SIZE;

            signal(semid, 2); // mutex
            signal(semid, 1); // full

            sleep(1);
        }
    } else {
        // Consumer
        for (i = 1; i <= 5; i++) {
            wait(semid, 1);   // full
            wait(semid, 2);   // mutex

            int item = buffer[out];
            printf("Consumer consumed: %d\n", item);
            out = (out + 1) % SIZE;

            signal(semid, 2); // mutex
            signal(semid, 0); // empty

            sleep(1);
        }
    }

    return 0;
}

üß† Semaphore Meaning (Viva-Ready)
Semaphore	Purpose
empty	Counts empty buffer slots
full	Counts filled buffer slots
mutex	Ensures mutual exclusion
üîπ Expected Output
Producer produced: 1
Consumer consumed: 1
Producer produced: 2
Consumer consumed: 2
...






üìå Important Viva Questions

Why mutex is needed?
‚Üí To avoid race condition

Why empty & full semaphores?
‚Üí To synchronize producer and consumer

What problem does this solve?
‚Üí Critical section & synchronization problem
